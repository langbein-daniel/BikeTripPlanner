version: '3.9'
name: ${BUILD_NAME:?}
services:

  #
  # DATA SOURCES
  #

  # Download GTFS zip file.
  gtfs-data:
    build:
      context: ./gtfs-data
      args:
        - GTFS_URL=${GTFS_URL:?}

  # Modify GTFS zip file.
  gtfs-modified:
    build:
      context: github.com/langbein-daniel/gtfs-modifications
      args:
        - BUILD_NAME=${BUILD_NAME:?}
        # If .env variable is empty, this build step is skipped. Thus no `:?`.
        - GTFS_MODIFICATION_PARAM=${GTFS_MODIFICATION_PARAM}

  # Filter GTFS zip file to bounding box.
  gtfs-filtered:
    build:
      context: ./gtfs-filter
      args:
        - BUILD_NAME=${BUILD_NAME:?}
        - MIN_LON=${MIN_LON:?}
        - MAX_LON=${MAX_LON:?}
        - MIN_LAT=${MIN_LAT:?}
        - MAX_LAT=${MAX_LAT:?}

  # Download OSM region and cut with bounding box.
  osm-excerpt:
    build:
      context: ./osm-excerpt
      args:
        - OSM_PBF_URL=${OSM_PBF_URL:?}
        - MIN_LON=${MIN_LON:?}
        - MAX_LON=${MAX_LON:?}
        - MIN_LAT=${MIN_LAT:?}
        - MAX_LAT=${MAX_LAT:?}
